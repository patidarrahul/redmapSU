{% extends 'base.html' %} {% load static %} {% load widget_tweaks %} {% load crispy_forms_tags %}
<!--  -->
{% block extrastyle %}
<style>
  .input-group-text {
    width: 25%;
    color: #7b7b7b;
    background-color: #f8f9fa;
    justify-content: center;
  }
  .form-group {
    margin-top: 10px;
  }

  .form-group label {
    margin-bottom: 5px;
  }

  input[type="text"],
  input[type="number"],
  input[type="date"],
  select,
  textarea,
  .input-group-text {
    height: 3rem; /* Adjust the height as needed */
    padding: 0.375rem 0.75rem; /* Adjust the padding as needed */
    line-height: 1.5; /* Ensure the text is centered */
  }

  .add-field {
    font-size: 20px;
    align-items: center;
  }
  .add-field:hover {
    -webkit-text-stroke: 2px;
  }
</style>

{% endblock extrastyle %} {% block content %}
<!-- x-data to show coating methods using coating parameters form -->
<div
  class="container mt-1"
  x-data='{
  showCoatingParam: true,
  coating_method: "{{ form.instance.coating_method}}"
}'
>
  <div class="row justify-content-center">
    <h1 class="mb-4" style="color: #7b7b7b">Update Layer</h1>

    <form method="post">
      {% csrf_token %}
      <div class="row">
        <div class="col-md-3 form-group">
          <label for="{{ form.stack.id_for_label }}">{{ form.stack.label }}</label>
          {{ form.stack }}
        </div>
        <!-- Coating Method -->
        <div class="col-md-3 form-group">
          <label for="{{ form.coating_method.id_for_label }}">{{ form.coating_method.label }}</label>
          <input type="hidden" name="coating_parameters" value="{{ form.instance.coating_parameters.id }}" />
          {% render_field form.coating_method @change="coating_method = $el.value" %}
        </div>

        <div class="col-md-3 form-group">
          <span class="d-flex justify-content-between">
            <label for="{{ form.created.id_for_label }}">{{ form.formulation.label }}</label>
            <a href="{% url 'formulation' %}" target="_blank" onclick="this.href" style="color: #7b7b7b; text-decoration: none"><i class="bi bi-plus add-field"> </i></a>
          </span>
          {{ form.formulation }}
        </div>

        <div class="col-md-3 form-group">
          <label for="{{ form.name.id_for_label }}">{{ form.name.label }}</label>
          {{ form.name }}
        </div>
        <div class="col-md-2 form-group">
          <label for="{{ form.formulation_volume.id_for_label }}">{{ form.formulation_volume.label }}</label>
          <div class="input-group">
            {{ form.formulation_volume }}
            <span class="input-group-text">mL</span>
          </div>
        </div>
        <div class="col-md-2 form-group">
          <label for="{{ form.sequence.id_for_label }}">{{ form.sequence.label }}</label>
          {{ form.sequence }}
        </div>
        <div class="col-md-2 form-group">
          <label for="{{ form.layer_type.id_for_label }}">{{ form.layer_type.label }}</label>
          {{ form.layer_type }}
        </div>

        <div class="col-md-2 form-group">
          <label for="{{ form.atmosphere.id_for_label }}">{{ form.atmosphere.label }}</label>
          {{ form.atmosphere }}
        </div>
        <div class="col-md-2 form-group">
          <label for="{{ form.room_temperature.id_for_label }}">{{ form.room_temperature.label }}</label>
          <div class="input-group">
            {{ form.room_temperature }}
            <span class="input-group-text"><sup>o</sup>C</span>
          </div>
        </div>
        <div class="col-md-2 form-group">
          <label for="{{ form.room_humidity.id_for_label }}">{{ form.room_humidity.label }}</label>
          <div class="input-group">
            {{ form.room_humidity }}
            <span class="input-group-text">%RH</span>
          </div>
        </div>
        <div class="col-md-3 form-group">
          <label for="{{ form.drying_type.id_for_label }}">{{ form.drying_type.label }}</label>
          {{ form.drying_type }}
        </div>
        <div class="col-md-2 form-group">
          <label for="{{ form.drying_temperature.id_for_label }}">{{ form.drying_temperature.label }}</label>
          <div class="input-group">
            {{ form.drying_temperature }}
            <span class="input-group-text"><sup>o</sup>C</span>
          </div>
        </div>
        <div class="col-md-2 form-group">
          <label for="{{ form.drying_time.id_for_label }}">{{ form.drying_time.label }}</label>
          <div class="input-group">
            {{ form.drying_time }}
            <span class="input-group-text">min</span>
          </div>
        </div>
        <div class="col-md-2 form-group">
          <label for="{{ form.created.id_for_label }}">{{ form.created.label }}</label>

          {{ form.created }}
        </div>

        <div class="col-md-3 form-group">
          <label for="{{ form.dry_film_thickness.id_for_label }}">{{ form.dry_film_thickness.label }}</label>
          <div class="input-group">
            {{ form.dry_film_thickness }}
            <span class="input-group-text">&micro;m</span>
          </div>
        </div>
        <div class="col-md-3 form-group">
          <label for="{{ form.treatment.id_for_label }}">{{ form.treatment.label }}</label>

          {{ form.treatment }}
        </div>
        <div class="col-md-2 form-group">
          <label for="{{ form.treatment_time.id_for_label }}">{{ form.treatment_time.label }}</label>
          <div class="input-group">
            {{ form.treatment_time }}
            <span class="input-group-text">sec</span>
          </div>
        </div>
        <div class="col-md-2 form-group">
          <label for="{{ form.treatment_power.id_for_label }}">{{ form.treatment_power.label }}</label>

          {{ form.treatment_power }}
        </div>
      </div>
      <hr />
      <h5>Coating Parameters Field</h5>
      <div x-show="showCoatingParam">
        <template x-if="coating_method === 'Spin Coating'">
          <div class="col-md-3 form-group">
            <span class="d-flex justify-content-between">
              <label for="{{ coating_parameters_form.spin_coating.id_for_label }}">{{ coating_parameters_form.spin_coating.label }}</label>
              <a href="{% url 'spin_coating' %}" target="_blank" onclick="this.href" style="color: #7b7b7b; text-decoration: none"><i class="bi bi-plus add-field"> </i></a>
            </span>
            {{ coating_parameters_form.spin_coating}}
          </div>
        </template>
        <template x-if="coating_method === 'Thermal Evaporation'">
          <div class="col-md-3 form-group">
            <span class="d-flex justify-content-between">
              <label for="{{ coating_parameters_form.thermal_evaporation.id_for_label }}">{{ coating_parameters_form.thermal_evaporation.label }}</label>
              <a href="{% url 'thermal_evaporation' %}" target="_blank" onclick="this.href" style="color: #7b7b7b; text-decoration: none"><i class="bi bi-plus add-field"> </i></a>
            </span>
            {{ coating_parameters_form.thermal_evaporation}}
          </div>
        </template>

        <template x-for="field in fields">
          <div class="col-md-3 form-group">{{ field }}</div>
        </template>
      </div>

      <hr class="mt-4" />
      <button type="submit" class="btn btn-primary mt-4">Update</button>
      <button type="submit" class="btn btn-secondary mt-4" name="save_as_new" value="save_as_new">Save as new</button>
    </form>
  </div>
</div>

{% endblock %}
